# AWS Personalize
 > 사용자에게 꼭 필요한 추천상품을 AWS 에서 제공하는 Algorithms(recipe)을 통해 검색 없이도 추천해줄 수 있는 기능. 
 
 > 이는 즉 매출 상승에 영향을 미친다 (AWS 의 지표 로는 30% 이상 증가)
 
 
## Personalize

 ### Data Pipeline

 사용자 중심 / ITEM 중심 / 사용자 - ITEM Interaction 인지에 따라서 **Schema 지정 및 Data Format 을 구성 및 준비**

 Process

  1.	사용자 ID, 항목 ID 등에 대한 Personalize 예약 키워드를 사용하여 데이터 세트를 정의하는 스키마를 생성합니다.
  2.	모델 구축 및 예측에 사용되는 데이터 세트를 포함하는 데이터 세트 그룹을 생성합니다. 여기에는 사용자-항목 상호 작용(“누가 무엇을 좋아하는지”), 사용자 및 항목 데 이터 세트가 포함될 수 있습니다. 아래의 예제에 나와 있듯이 마지막 2개는 선택 사항입니다.
  3.	Personalize로 데이터를 보냅니다.
  4.	솔루션을 생성합니다. 즉, 추천 레시피를 선택하고 데이터 세트 그룹에서 훈련합니다.
  5.	새로운 샘플을 예측하는 캠페인을 생성합니다.
 
 
![undefined](https://user-images.githubusercontent.com/48753593/66401545-48a1ea00-ea1e-11e9-94cb-ad9690c86c8e.png)
![inawisdom-1](https://user-images.githubusercontent.com/48753593/66401650-75560180-ea1e-11e9-8977-975f9c191f94.gif)
![product-page-diagram_amazon_personalize_how-it-works 3ceac8883c7d6bd67d7cf26d8a7d505520d02a40](https://user-images.githubusercontent.com/48753593/66401654-76872e80-ea1e-11e9-93d8-2c3f32bed16f.png)
 
##### Data Formatting 과 형식만 잘 잡혔다면 데이터를 올리고 난후 모델 생성은 매우 간단하다

사람들이 클릭을 했을때 특정 상품에 대해서 관심을 최근에 얼마나 갖고 있었는가를 가지고 이후상품에 대한 추천을 하는 모델


<hr />

### Personalize Update

 ##### Airflow를 활용한 방법 
  
  특정 시간마다 S3 부터 생성 하는 과정을 반복한다. 데이터가 클수록 소요시간이 길어진다 
 
 ##### PutEvents API를 활용한 방법.
 
  ```
 PutEvents를 통해 요구하는 형태의 데이터를 모은다. Cloud Watch를 통해 생성된 데이터를 확인한다.
  
 최종적으로 create solution version -> campaign update 를 통해 추천결과를 업데이트 한다.
 
 trainning을 주기적으로 해야한다.
 
 put event 시 데이터는 들어가 있고, 트레이닝만 다시해주면 된다.
 ```




기업 소개
1.  크런치 프라이스 
	종합 커머스 서비스
 모든 참여자(판매자 * 소비자) 가 경제적으로 만족 할 수 있는 방법으로 가장 싸게 상품을 공급한다 를 모토로 하여 여러 상품(네이버 50만개) 을 제공하는 업체 입니다.



AWS Personalize

Q: Amazon Personalize 란 무엇입니까?

Amazon Personalize는 개발자가 자신의 애플리케이션을 사용하는 고객에게 개인 맞춤식 권장 사항을 쉽게 추가할 수 있도록 해주는 기계 학습 서비스

	
Q: Amazon Personalize를 사용해야 하는 이유는 무엇입니까?
A: Amazon Personalization은 다양한 업계에서 주요 사용자 참여와 수익 지표를 높이는 것으로 증명되었습니다. 전자 상거래 비즈니스의 15억 개 쇼핑 세션에 대한 시장 분석에 의하면 추천 제품 덕분에 수익이 11.5% 증가한 것으로 나타났습니다. 예를 들어 Amazon.com에서 페이지 보기의 30%는 추천 제품을 통해 유도되었습니다.

Q: Amazon Personalize에서 지원하는 주요 사용 사례는 무엇입니까?
A: Amazon Personalize는 다음 주요 사용 사례를 지원합니다.
맞춤형 추천
유사 항목
맞춤형 재지정(예: 사용자의 항목 목록 재지정)
맞춤형 프로모션/알림

이중 크런치 프라이스는 맞춤형 추천 / 유사 항목 에 대해서 적용.


Q: Amazon Personalize에 대한 일반적인 비즈니스 애플리케이션은 무엇입니까?
A: Amazon Personalize는 모든 디지털 채널에서의 최종 사용자 환경을 맞춤화하는 데 사용할 수 있습니다. 전자 상거래에 대한 제품 추천, 출판, 미디어 및 소셜 네트워크의 뉴스 기사와 콘텐츠 추천, 여행 웹 사이트의 호텔 추천, 은행의 신용 카드 추천 및 데이트 사이트에서의 상대 추천 등을 예로 들 수 있습니다. 이러한 추천 및 맞춤형 환경은 웹 사이트, 모바일 앱 또는 이메일/메시징을 통해 제공될 수 있습니다. Amazon Personalize는 또한 물리적 채널에서 사용자 상호 작용이 있는 경우에도 사용자 환경을 사용자 지정하는 데 이용할 수 있습니다(예: 식품 배달 회사에서 구독 플랜 사용자에 대해 주간 식품을 맞춤화할 수 있음).



Amazon Personalize 사용 ( 작동 방식 )
Q: Amazon Personalize를 시작하려면 어떻게 해야 합니까?
A: 
1.사용자 ID, 항목 ID 등에 대한 Personalize 예약 키워드를 사용하여 데이터 세트를 정의하는 스키마를 생성합니다.
2.모델 구축 및 예측에 사용되는 데이터 세트를 포함하는 데이터 세트 그룹을 생성합니다. 여기에는 사용자-항목 상호 작용(“누가 무엇을 좋아하는지”), 사용자 및 항목 데이터 세트가 포함될 수 있습니다. 아래의 예제에 나와 있듯이 마지막 2개는 선택 사항입니다.
3.Personalize로 데이터를 보냅니다.
4.솔루션을 생성합니다. 즉, 추천 레시피를 선택하고 데이터 세트 그룹에서 훈련합니다.
5.새로운 샘플을 예측하는 캠페인을 생성합니다.




Q: Amazon Personalize에 어떤 데이터를 제공해야 합니까?
A: 개발자는 Amazon Personalize에 다음 데이터를 제공해야 합니다.
사용자 활동 스트림 또는 이벤트 데이터 - 웹 사이트/애플리케이션의 사용자 상호 작용 데이터는 이벤트의 형식으로 캡처되어 주로 한 줄의 코드가 포함된 통합을 통해 Amazon Personalize로 전송됩니다. 여기에는 클릭, 구입, 시청, 장바구니에 추가, 좋아요 등과 같은 주요 이벤트가 포함됩니다. 서비스 온보딩 시 개발자는 가능한 경우 모든 이벤트/활동 스트림 데이터의 기록 로그 또한 제공할 수 있습니다.
카탈로그(항목) 데이터 - 책, 비디오, 뉴스 기사 또는 제품을 포함한 모든 유형의 카탈로그가 될 수 있습니다. 각 항목과 연결된 항목 ID 및 메타데이터가 포함됩니다. 이 데이터는 선택 사항입니다. 
사용자 데이터 - 성별 및 나이와 같은 사용자 인구 데이터를 포함한 사용자 프로필 데이터입니다. 이 데이터는 선택 사항입니다.

Amazon Personalize는 이 데이터를 기반으로 모델을 훈련 및 배포합니다. 개발자는 간단한 추론 API를 사용하여 런타임에 개별화된 추천 사항을 가져오고 개인 설정 모델의 유형(예: 사용자 개인화, 관련 항목 또는 개인화된 재지정)에 따라 최종 사용자에게 개인화된 환경을 생성할 수 있습니다.






Q: Amazon Personalize 추천을 비즈니스 워크플로 또는 애플리케이션에 어떻게 적용합니까?
A: Amazon Personalize는 두 가지 추론 API(getRecommendations 및 getPersonalizedRanking)를 제공합니다. 이러한 API는 사용자에 대한 추천 itemID 목록, 항목에 대한 유사한 항목 목록 또는 사용자에 대한 항목의 재지정 목록을 반환합니다. itemID는 제품 식별자, videoID 등일 수 있습니다. 고객은 이러한 itemID를 사용하여 이미지 및 설명 검색, 디스플레이 렌더링과 같은 단계를 거쳐 최종 사용자 환경을 생성합니다. 일부 경우에 따라 고객이 AWS나 타사의 이메일 전송 서비스 또는 알림 서비스 등을 통합하여 최종 사용자 환경을 생성할 수 있습니다.



Q: Amazon Personalize에서 맞춤형의 효율성은 어떻게 측정됩니까?
A: 맞춤형 솔루션의 효율성은 고객이 최적화하고자 하는 비즈니스 목표를 우선 지정하고 A/B 테스트를 통해 해당 목표에 미치는 영향을 측정함으로써 판단될 수 있습니다. 이러한 목표는 일반적으로 클릭 수, 사용자당 수익, 세션당 수익, 세션당 평균 소모 시간, 보존 비율 등이 있습니다. 또한 Amazon Personalize는 고객 데이터에 대해 훈련된 모델에 대한 오프라인 지표를 제공합니다.




Personalize 구축 중 생긴 문제 와 고려 사항

실시간 데이터 처리 ( DB에 있는 데이터 샘플 수 에 따른 데이터 처리 ) 

  초기 S3 에 CSV 파일로 다룬 item-user interaction data는 6900 여 개의 데이터로 recommendation 테스트를 하였고, recommendation의 경우 userId 를 기준으로 추천을 받았으며, 초기 구현시 예상 데이터로 각각의 userId 마다 서로 다른 추천 데이터를 받기를 기대 하였으나 결과적으로 각기 다른 userId에 같은 상품을 추천해주는 문제 가 발생.

이후 문제를 초기 데이터 샘플의 수가 적어서 cold start recipe를 기준으로 추천해주는 상태일 것이라 결론을 내리고,  AWS Guideline 에 따라서 Put Events API를 활용하여 설정해둔 Schema 의 Field에 맞춰서 events를 추가 , 데이터 샘플 수를 증가 시킴.

AWS Cloud Watch를 통해 Events가 에러 없이 추가 되는 것을 확인.
(  S3 CSV 데이터 자체를 업데이트 한 것 이 아니며, 업데이트 된 실시간 데이터는 Cloud Watch 로만 확인이 가능한 점 이 불편했으나 데이터 가공 및 처리 자체를 AWS 알고리즘이 작동 하므로, 우리가 신경 쓸 부분이 아니라고 생각 )

이벤트가 추가된 지표(25,000개)를 토대로 하여 Solution Version Update를 AWS 콘솔상에서 실행.  
이후 Get Recommendation 를 요청 했을때, 기존 데이터와 같은 추천값을 반환.

상식적으로 6900 개의 데이터와 25000 개의 데이터 간의 차이가 없는 것은 말이 안되므로,
AWS Personalize 설정 과정을 백트래킹 했고, 일련의 과정을 모두 재설정 하였다.

=> 이후 solution version update 뿐만 아니라 campaign update 또한 필요하다는 걸 알게 되었다.

현재 크런치 프라이스는 Put Events를 활용한 실시간 데이터 업데이트 가 아닌 airflow 라는 scheduler 를 활용 하루에 쌓인 데이터를, 사용자가 적은 시간대에 S3 에 저장된 CSV 파일 부터 차례대로 import job - create solution version - update campaign의 과정을 통해 데이터를 업데이트, 사용자 추천 품목을 변화시키는 방안을 채택 활용하고 있다.



결론

Personalize 세팅에 있어서 고려해야 할 가장 주된 사항을 고르라면, AWS Personalize를 사용할 고객이 갖고 있는 데이터 가 Personalize에 요구하는 Schema Field에 맞도록 데이터를 알맞게 구성하는게 제일 중요한 부분이라고 생각한다.

가령 크런치 프라이스의 예를 들면, 필수적으로 들어가는 TIMESTAMP 값이나 선택사항인 EVENT TYPE의 경우가 있다.
크런치 프라이스 사용자가 해당 상품 페이지에 접속한 시간을 TIMESTAMP 값으로 넣어줬으며 , EVENT TYPE은 Click, Add to Cart 등 과 같이 의미있는 값을 데이터로 넘겨야 보다 정확한 추천 결과를 받을 수 있다.

또한 사용자 입맛에 맞게 recipe라 불리는 알고리즘을 선택 하여 추천에 적용할 수 있으므로, 초기 AUTO 로 AWS 추천해주는 레시피 대로 추천 알고리즘을 사용하다가, 이후 지표를 확인후에 solution을 수정하거나 추가하는식으로 보다 정확한 추천을 받을 수 있다.

 
